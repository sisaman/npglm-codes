\documentclass[]{article}
\usepackage[parfill]{parskip}
\usepackage{amsmath}
%opening
\title{NP-GLM Method Formulations}
\author{Sina Sajadmanesh}

\begin{document}

\maketitle

Intensity and Survival functions:
\[\lambda(t\mid x)=\frac{f_T(t\mid x)}{S(t\mid x)}=-\frac{d}{dt}\ln S(t\mid x) \]
\[S(t\mid x)=\exp\{\int_{0}^{t}\lambda(t\mid x)dt\}\]
Hypothesis: 
\[\lambda(t\mid x)=\exp(w^Tx)h(t)\]
Likelihood:
\begin{equation*}
\begin{split}
\mathcal{L}(D)=&\prod_{i=1}^{N}f_T(t_i\mid x_i)^{y_i}P(T\ge t_i\mid x_i)^{1-y_i}\\
=&\prod_{i=1}^{N}f_T(t_i\mid x_i)^{y_i}S(t_i\mid x_i)^{1-y_i}\\
=&\prod_{i=1}^{N}[\lambda(t_i\mid x_i)S(t_i\mid x_i)]^{y_i}S(t_i\mid x_i)^{1-y_i}\\
=&\prod_{i=1}^{N}\lambda(t_i\mid x_i)^{y_i}S(t_i\mid x_i)\\
=&\prod_{i=1}^{N}\left[\exp(w^Tx_i)h(t_i)\right]^{y_i}\exp\lbrace-\exp(w^Tx_i)\int_{0}^{t_i}h(t)dt\rbrace
\end{split}
\end{equation*}

Assumptions:
\begin{itemize}
\item $h(t)$ is a piecewise constant function which changes just in $t_i$ s.
\item $t_i$ s are sorted in increasing order.
\end{itemize}

Then:
\[H(t_i)=\int_{0}^{t_i}h(t)dt = \sum_{j=1}^{i}h(t_j)(t_j-t_{j-1})\]

Continue with the likelihood:
\begin{equation*}
\begin{split}
\mathcal{L}(D)
=&\prod_{i=1}^{N}\left[\exp(w^Tx_i)h(t_i)\right]^{y_i}\exp\lbrace-\exp(w^Tx_i)H(t_i)\rbrace\\
=&\prod_{i=1}^{N}\left[\exp(w^Tx_i)h(t_i)\right]^{y_i}\exp\lbrace-\exp(w^Tx_i)\sum_{j=1}^{i}h(t_j)(t_j-t_{j-1})\rbrace\\
\end{split}
\end{equation*}

Log-Likelihood function:

\begin{equation*}
\begin{split}
\log\mathcal{L}(D)
=&\sum_{i=1}^{N}\left\lbrace y_i\left[w^Tx_i + \log h(t_i)\right]-\exp(w^Tx_i)\sum_{j=1}^{i}h(t_j)(t_j-t_{j-1})\right\rbrace\\
\end{split}
\end{equation*}

With respect to $h(t_k)$:
\begin{equation*}
\begin{split}
\log\mathcal{L}(D)&=y_k\log h(t_k)-\sum_{i=k}^{N}\exp(w^Tx_i)h(t_k)(t_k-t_{k-1})\\
\frac{\partial}{\partial h(t_k)}\log\mathcal{L}(D)&=\frac{y_k}{h(t_k)}-(t_k-t_{k-1})\sum_{i=k}^{N}\exp(w^Tx_i)=0\\
h(t_k)&=\frac{y_k}{(t_k-t_{k-1})\sum_{i=k}^{N}\exp(w^Tx_i)}\\
\end{split}
\end{equation*}

Therefore we have:

\begin{equation*}
\begin{split}
H(t_i) = \sum_{j=1}^{i}h(t_j)(t_j-t_{j-1})=\sum_{j=1}^{i}\frac{y_j}{\sum_{k=j}^{N}\exp(w^Tx_k)}\\
\end{split}
\end{equation*}
\[h(t_i) = \frac{H(t_i)-H(t_{i-1})}{t_i-t_{i-1}}\]

With respect to $w$:
\begin{equation*}
\begin{split}
-\log\mathcal{L}(D)
=&\sum_{i=1}^{N}\left\lbrace\exp(w^Tx_i)H(t_i)-y_iw^Tx_i\right\rbrace\\
-\frac{\partial}{\partial w}\log\mathcal{L}(D)=&\sum_{i=1}^{N}\left\lbrace\exp(w^Tx_i)H(t_i)x_i-y_ix_i\right\rbrace\\
=&\sum_{i=1}^{N}x_i\left[\exp(w^Tx_i)H(t_i)-y_i\right]\\
-\frac{\partial^2}{\partial w^2}\log\mathcal{L}(D)=&\sum_{i=1}^{N}x_ix_i^T\exp(w^Tx_i)H(t_i)\\
\end{split}
\end{equation*}

Finally:
\[f_T(t\mid x)=\exp(w^Tx)h(t)\exp(-\exp(w^Tx)H(t))\]

\end{document}
